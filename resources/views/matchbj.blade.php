<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>RoboCom北京挑战赛</title>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/matchbj.css')}}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/kenrobot.css')}}">
    <link href="https://cdn.bootcss.com/datepicker/0.5.3/datepicker.css" rel="stylesheet">
</head>
<body>
    <div class="main">
        <div class="header">
            <div class="inner">
                <img src="{{ asset('assets/img/logo1-beijing.png')}}" alt="">
                <div class="logout">
                    <span></span>
                </div>
            </div>
        </div>
        <div class="instructions clearfix active">
            <h1 class="instructions-h">2017年世界机器人大赛—RoboCom国际公开赛报名须知</h1>
            <span class="instructions-span"> 1. 报名时间截止日期：2017年8月15日 </span>
            <span class="instructions-span"> 2. 缴费截止日期： 2017年8月18日</span>
            <span class="instructions-span"> 3. 正式报名前，应仔细阅读本须知，并按要求认真填写个人基本信息，填写内容必须真实、完整、准确。如同意报名相关条款，点击“同意”后方可继续进行网上报名操作。</span>
            <span class="instructions-span" style="color:red;padding-left: 20px;"> 重要提示：请确保带队老师和参赛队员的姓名、身份证件类型、证件编码等个人信息的真实性和准确性，如有错误，可能导致报名失败。参赛队员的信息将用于2017年世界机器人大赛—RoboCom国际公开赛，报名人员须对其提交的错误信息造成的后果负责。</span>
            <span class="instructions-span">4. 联系“通知中”各个项目的报名负责人，索取相应的项目邀请码。</span>
            <span class="instructions-span">5. 每条邀请码仅有效使用1次。请严格、谨慎的填写信息。一旦提交，将不再做修改。</span>
            <span class="instructions-span">6. 报名完成后，请注意保存自己的队伍编码，以备查询核实之用。</span>
            <span class="instructions-span">7. 参赛费用将不在网上报名中缴纳，具体缴费流程请联系相应赛项交费联系人（见交费流程）。</span>
            <span class="instructions-span">8. 报名资料填写完整，经组委会审核通过后，会在RoboCom官方网站进行公示。</span>
            <br/>
            <h2 style="color: red;">交费流程如下：</h2>
            <br/>
            <span class="instructions-span" >在线报名完成后，请根据自己所报赛项联系相应的项目参赛联系人缴费（请保留在线报名的队伍编码和转账成功的截图以方便核实）。</span>
            <br/>
            <br/>
            <span class="instructions-span">1. 联系相关项目的收费负责人。</span>
            <span class="instructions-span" style="padding-left: 20px;"> a)“未来世界”、“博思威龙”、“智造大挑战”项目的参赛交费联系人：曾令勇  158 9994 8376</span>
            <span class="instructions-span" style="padding-left: 20px;"> b)“工业时代”、“攻城大师”、“创客生存挑战赛”项目的参赛交费联系人：李达 158 7649 3817</span>
            <span class="instructions-span">2. 核实参赛队伍是否报名成功。并核实参赛人数。</span>
            <span class="instructions-span">3. 支付参赛注册费</span>
            <span class="instructions-span" style="padding-left: 20px;">付款对公账户：</span>
            <span class="instructions-span" style="padding-left: 20px;">开户名称：北京工道动力机器人技术研究院</span>
            <span class="instructions-span" style="padding-left: 20px;">开户行号：313100022226</span>
            <span class="instructions-span" style="padding-left: 20px;">银行账号：410100203296687</span>
            <h2 class="" style="margin-bottom: 20px; margin-top: 15px;">附一：各赛项负责人</h2>

            <span class="instructions-span" style="padding-left: 20px;"> a)“未来世界”项目联系人：李蒙 136 2109 4852</span>
            <span class="instructions-span" style="padding-left: 20px;"> b)“工业时代”项目联系人：谢尊国 150 0077 4186</span>
            <span class="instructions-span" style="padding-left: 20px;"> c)“博思威龙”项目联系人：陆超 137 1326 2010</span>
            <span class="instructions-span" style="padding-left: 20px;"> d)“攻城大师”项目联系人：王勇 15361056983</span>
            <span class="instructions-span" style="padding-left: 20px;"> e)“智造大挑战” 项目联系人：谢俊杰 186 0301 5057</span>
            <span class="instructions-span" style="padding-left: 20px;"> f)“创客生存挑战赛”项目联系人：李乔 176 0089 9441</span>

            <h2 style="margin-bottom: 20px; margin-top: 15px;">附二：报名表填写说明</h2>

            <span class="instructions-span clearfix"><i>信息项</i>填写说明</span>
            <span class="instructions-span clearfix"><i>邀请码</i>由赛项负责人提供的16位邀请码，每个邀请码只能使用一次</span>
            <span class="instructions-span clearfix"><i>姓名</i>填写有效证件上的姓名，姓名只能包含汉字和英文</span>
            <span class="instructions-span clearfix"><i>手机号码</i>填写11位有效手机号码。如参赛选手没有手机则须填写带队老师或监护人手机号码</span>
            <span class="instructions-span clearfix"><i>邮箱/E-mail</i>填写有效邮箱地址</span>
            <span class="instructions-span clearfix"><i>身份证号</i>填写有效18位居民身份证号</span>
            <span class="instructions-span clearfix"><i>照片</i>须上传2寸免冠登记照，大小不能大于2MB</span>
            <span class="instructions-span clearfix"><i>队伍名称</i>填写参赛队伍的名称，不接受已存在的队伍名称</span>
            <span class="instructions-span clearfix"><i>学校/单位名称</i>填写所属学校或单位名称</span>
            <span class="instructions-span clearfix"><i>赛事项目</i>选择队伍参加的赛项</span>
            <span class="instructions-span clearfix"><i>子赛项</i>选择参队伍加的子赛项</span>
            <span class="instructions-span clearfix"><i>组别</i>选择参队伍加的组别</span>
            <span class="instructions-span clearfix"><i>出生日期</i>真实出生年月</span>
            <span class="instructions-span clearfix"><i>性别</i>填写真实性别</span>
            <span class="instructions-span clearfix"><i>身高</i>填写真实身高（用于制定活动用T恤尺寸）</span>
            <span class="instructions-span clearfix"><i>证件类型</i>选择有效的身份证件类型</span>
            <span class="instructions-span clearfix"><i>证件号码</i>填写有效的身份证件号码</span>
            <span class="instructions-span clearfix"><i>居住省市</i>填写现居住的省和市</span>
            <span class="instructions-span clearfix"><i>职务</i>填写真实职业</span>
            <span class="instructions-span clearfix"><i>账户类型</i>需要开收据还是发票或是都不需要</span>
            <span class="instructions-span clearfix"><i>发票抬头</i>收款机构的抬头</span>
            <span class="instructions-span clearfix"><i>统一社会信用代码</i>填写真实统一社会信用代码</span>
            <span class="instructions-span clearfix"><i>收件地址</i>票据需要邮寄到的地址</span>
            <span class="instructions-span clearfix"><i>开票金额</i>选择单人所缴纳的费用</span>
            <span class="instructions-span clearfix"><i>汇款账户</i>发票抬头账户的汇款号</span>
            <span class="instructions-span clearfix"><i>验证码</i>填写发送到手机的6位数验证码</span>
            <span class="instructions-span clearfix"><i>备注</i>填写需要补充的信息</span>






            <div class="clear"></div>
            <a id="btn-read" class="disabled" type="button">我同意</a>
            <span class="span-read">阅读,并同意</span>
            <input type="checkbox" id="input-read" name="" value=""/>
        </div>

        <div class="content">
            <form id="form" name="form" action="/signup" enctype="multipart/form-data" method="POST" onkeydown="if(event.keyCode==13)return false;"  style="width: 1004px;">
            <!-- <form id="form" name="form" action="/signup" enctype="multipart/form-data" method="POST" novalidate="novalidate" style="width: 1004px;"> -->
                <div class="tab_menu">
                    <ul>
                        <li class="active">联系人信息</li>
                        <li>领队老师/教练信息</li>
                        <li>赛项信息</li>
                        <li>队员信息</li>
                        <li>开票信息</li>
                        <li>信息确认</li>
                    </ul>
                </div>
                <div class="all_info clearfix">
                    <div class="contact_info div_tab clearfix active">
                        <div class="input-field">
                            <span class="input-label">邀请码  :</span>

                            <input tip-warn="邀请码不能为空" tip-info="输入邀请码" data-type="invitecode" required class="input-field-text" id="invitecode" name="invitecode" type="text" value="{{$signdata['invitecode'] or ''}}">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">是否添加联系人  :</span>
                            <select class="input-field-text" id="add_contact">
                                <option value="yes">添加</option>
                                <option value="no" selected>不添加</option>
                            </select>
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">联系人姓名  :</span>
                            <input tip-warn="" tip-info="仅支持英文、汉字" data-type="realname" class="input-field-text add_contact disabled" readonly  id="contact_name" name="contact_name" type="text" value="">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">联系人手机号码  :</span>
                            <input tip-info="请填联系人手机号码" data-type="mobile" class="input-field-text add_contact disabled" readonly  id="contact_mobile" type="text" name="contact_mobile" value="">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">联系人邮箱  :</span>
                            <input tip-info="请按照正确的邮箱格式填写" data-type="email" class="input-field-text add_contact disabled" readonly id="contact_email" name="contact_email" type="text" value="">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">联系人备注  :</span>
                            <input tip-info="请填写备注内容" class="input-field-text add_contact disabled" id="contact_remark" readonly name="contact_remark" type="text" value="">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label" style="width: auto; color: red;">* 联系人部分为选填内容,如果不填写,默认第一个领队老师为联系人!!!</span>
                        </div>
                        <button type="button" class="btn_next" id="leader_info_btn">下一步</button>
                    </div>
                    <div class="leader_info div_tab clearfix">
                        <div class="clearfix teachers">
                        </div>
                        <button type="button" id="add_teacher">添加领队信息</button>

                        <button type="button" class="btn_pre">上一步</button>
                        <button type="button" class="btn_next">下一步</button>
                    </div>
                    <div class="ranks_info div_tab">
                        <div class="input-field" style="display: none;">
                            <span class="input-label">队伍编号  :</span>
                            <input  id="team_no" name="team_no" type="hidden" value="{{$team_no or ''}}">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">队伍名称  :</span>
                            <input data-type="schoolname|teamname" required tip-warn="" tip-info="请输入您队伍的名称" class="input-field-text" id="team_name" name="team_name" type="text" value="">
                            <div class="tips"></div>
                        </div>
                        <div class="input-field">
                            <span class="input-label">赛事项目  :</span>
                            <select class="select-box" id="competition_1" name="competition_name" level="1"></select>
                        </div>
                        <div class="input-field">
                            <span class="input-label">赛事名称  :</span>
                            <select class="select-box" id="competition_2" name="competition_type" level="2"></select>
                        </div>
                        <div class="input-field">
                            <span class="input-label">组别  :</span>
                            <select class="select-box" id="competition_3" name="competition_event_id" level="3"></select>
                        </div>
                        <div class="input-field">
                            <span class="input-label">备注  :</span>
                            <input tip-info="填写备注" class="input-field-text" id="remarks" name="remarks" type="text" value="">
                            <div class="tips"></div>
                        </div>
                        <button type="button" class="btn_pre">上一步</button>
                        <button id="checkTeamName" type="button" class="btn_next">下一步</button>
                    </div>
                    <div class="student_info div_tab">
                        <span class="title-span">*队员最多8人</span>
                        <div class="clearfix students">
                        </div>

                        <button type="button" class="btn_new" id="add_student">添加新成员</button>
                        <button type="button" class="btn_pre">上一步</button>
                        <button type="button" class="btn_next">下一步</button>
                    </div>
                    <div class="payment div_tab">
                        <div class="enroll-notice">
                            <div class="input-field">
                                <span class="input-label">开票类型 :</span>
                                <select name="invoice_type" id="invoice_type" class="input-field-text">
                                    <option value="发票" selected>发票</option>
                                    <option value="收据">收据</option>
                                    <option value="不开票">不开票</option>
                                </select>
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">发票抬头(*收款机构的抬头) :</span>
                                <input required data-type='schoolname' tip-info="发票抬头" class="input-field-text invoice-group" id="invoice_title" name="invoice_title" type="text" value="{{$signdata['invoice_header'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">统一社会信用代码 :</span>
                                <input required data-type='' tip-info="统一社会信用代码" class="input-field-text invoice-group" id="invoice_code" name="invoice_code" type="text" value="{{$signdata['invoice_header'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">开票金额 :</span>
                                <input required data-type='float' tip-info="开票金额" class="input-field-text invoice-group" id="invoice_money" name="invoice_money" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">收件地址 :</span>
                                <input required data-type='schoolname' tip-info="收件地址" class="input-field-text invoice-group" id="invoice_mail_address" name="invoice_mail_address" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">联系人姓名 :</span>
                                <input required data-type='realname' class="input-field-text invoice-group" id="invoice_mail_recipients" name="invoice_mail_recipients" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">联系电话 :</span>
                                <input required data-type='mobile' tip-info="联系电话" class="input-field-text invoice-group" id="invoice_mail_mobile" name="invoice_mail_mobile" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">E-mail :</span>
                                <input required data-type='email' tip-info="电子邮件" class="input-field-text invoice-group" id="invoice_mail_email" name="invoice_mail_email" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                            <div class="input-field">
                                <span class="input-label">备注 :</span>
                                <input class="input-field-text invoice-group" id="invoice_remark" name="invoice_remark" type="text" value="{{$signdata['total_cost'] or ''}}">
                                <div class="tips"></div>
                            </div>
                        </div>
                        <button type="button" class="btn_pre">上一步</button>
                        <button type="button" class="btn_next">下一步</button>
                    </div>

                    <div class="preview_info div_tab">
                        <div class="leader" id="number-leader">
                            <span class="leader_title">带队老师信息(如果无数据,第一个领队教师为联系人)</span>
                            <div class="cut"></div>
                            <div class="input-field">
                                <span class="name">真实姓名 :</span>
                                <span  id="preview_contact_name" class="name_input" ></span>
                            </div>
                            <div class="input-field">
                                <span class="name">联系人手机号 :</span>
                                <span  id="preview_contact_mobile" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span  class="name">联系人邮箱 :</span>
                                <span id="preview_contact_email" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name">联系人备注 :</span>
                                <span  id="preview_contact_remark" class="name_input" style="margin-bottom: 40px;"></span>
                            </div>
                        </div>
                        <div class="leader" id="leader">
                            <span class="leader_title">领队老师信息</span>
                            <div id="preview_leader">

                            </div>

                        </div>
                        <div class="leader" id="team">
                            <span class="leader_title">队伍信息</span>
                            <div class="cut"></div>
                            <div class="input-field">
                                <span class="name">队伍编号 :</span>
                                <span id="preview_team_no" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name">队伍名称 :</span>
                                <span id="preview_team_name" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name">赛事项目 :</span>
                                <span id="preview_competition_1" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name"></span>
                                <span id="preview_competition_2" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name">组别 :</span>
                                <span id="preview_competition_3" class="name_input"></span>
                            </div>
                            <div class="input-field">
                                <span class="name">备注 :</span>
                                <span id="preview_remarks" class="name_input"></span>
                            </div>
                        </div>
                        <div class="all_number">
                            <span class="leader_title">队员信息</span>
                            <div class="team_number" id="preview_member">

                            </div>
                        </div>
                        <div class="pays clearfix" id="pays">
                            <span class="leader_title">开票信息</span>
                            <div class="cut"></div>
                            <span class="name">发票抬头 :</span>
                            <span id="preview_invoice_title" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">信用代码 :</span>
                            <span id="preview_invoice_code" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">开票金额 :</span>
                            <span id="preview_invoice_money" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">开票明细 :</span>
                            <span id="preview_invoice_type" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">收件地址 :</span>
                            <span id="preview_invoice_mail_address" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">联系人姓名 :</span>
                            <span id="preview_invoice_mail_recipients" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">联系人电话 :</span>
                            <span id="preview_invoice_mail_mobile" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">E-mail :</span>
                            <span id="preview_invoice_mail_email" class="name_input"></span>
                            <div class="clearfix clear"></div>
                            <span class="name">备注 :</span>
                            <span id="preview_invoice_remark" class="name_input"></span>
                            <div class="clearfix clear"></div>
                        </div>
                        <div id="code" class="clearfix">
                            <span class="input-label">验证码  :</span>
                            <!-- <input required name="verificationcode" id="verificationcode" tip-info="请输入您收到的验证码" class="code" type="text"> -->
                            <input name="verificationcode" data-type="required|verificationcode" id="verificationcode" class="code" type="text">
                            <a id="getverifycode" class="tel">获取手机验证码</a>

                            <div class="tips"></div>
                        </div>
                        <div class="clearfix"></div>
                        <button type="button" class="btn_pre">上一步</button>
                        <!-- <button type="submit" class="btn_next">确认提交</button> -->
                        <button type="button" id="getQrcode" class="btn_next">确认提交</button>
                        <input class="btn_next" id="submit" style="display: none;" type="submit" value="确认提交" />
                    </div>
                </div>
            </form>
        </div>
        <div class="footer">
            <div class="inner">
                <div class="logo-all">
                    <img src="{{ asset('assets/img/LOGO2.png')}}" alt="">
                    <img src="{{ asset('assets/img/logo-white-word.png')}}" alt="">
                </div>
                <span class="sp1">© 2017 RoboCom 国际公开赛组委会  |  鄂ICP备16011249号-2 </span>
                <span class="sp2">技术支持: 北京啃萝卜信息技术有限公司</span>
            </div>
        </div>
        <div class="verificationcode_box">
            <div class="showBox">
                <span class="tip">提示: 请您在右侧输入图中的数字或者字母~</span>
                <span id="tipes">验证成功之后,我们会将验证码发送至您的手机:  <i></i></span>
                <span class="tipes-false">您输入的验证码有误,请核对后重新输入!!!</span>
                <img id="captcha_img1" src="{{url('/captcha')}}">
                <input id="v_code" type="text" placeholder="请输入">
                <a id="sendCode" class="yes">确认</a>
                <a class="no"><i class="icon kenrobot ken-close"></i></a>
            </div>
        </div>
        <div class="codeError">
            <div class="showBox">
                <i class="icon kenrobot ken-close close"></i>
                <div class="clear"></div>
                <i class="icon kenrobot ken-close"></i>
                <p>您输入的手机验证码有误,请核对短信后再次输入~</p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{{ asset('assets/js/jquery.min.js')}}"></script>
    <script type="text/javascript" src="{{ asset('assets/js/jsrender.js')}}"></script>
    <script type="text/javascript" src="{{ asset('assets/js/helpers.js')}}"></script>

    <script src="https://cdn.bootcss.com/datepicker/0.5.3/datepicker.min.js"></script>
    <script src="https://cdn.bootcss.com/datepicker/0.5.3/i18n/datepicker.zh-CN.min.js"></script>
    <script type="text/javascript">

        // *********************************
        //              通用
        // *********************************

        $.fn.datepicker.setDefaults({
            language: 'zh-CN',
            format: 'yyyy-mm-dd'
        });

        // 输入提示
        (function($){
            $.fn.tipInfo = function(tipMsg){
                $(this).siblings('.tips').html('<span class="info">'+tipMsg+'</span>');
            }
            $.fn.tipWarn = function(tipMsg) {
                $(this).siblings('.tips').html('<span class="warn">'+tipMsg+'</span>')
            }
            $.fn.tipValid = function() {
                $(this).siblings('.tips').html('<span class="valid"><i class="icon kenrobot ken-check"></i></span>');
            }
            $.fn.tipClear = function() {
                $(this).siblings('.tips').html('');
            }
            $.fn.refreshCaptcha = function() {
                var timestamp = Date.parse(new Date());
                $(this).attr('src', "{{url('/captcha')}}"+"?t="+timestamp);
            }

            // 倒计时
            $.fn.countdown = function() {
                var timelimit = 60;
                var that = this;
                var old_text = $(this).html();
                var countdown = setInterval(function() {
                    $(that).html('('+ timelimit-- + ')s后重新获取验证码');
                    $(that).addClass('disabled');
                    if (timelimit <= 0) {
                        $(that).html(old_text);
                        $(that).removeClass('disabled');
                        clearInterval(countdown);
                    }
                }, 1000);
            }
        })(jQuery);


        // 校验表单字段
        function validField(el) {
            var $el = $(el);

            var name = $el.prop('name');
            var type = $el.prop('type');
            var id = $el.prop('id');
            var val = $el.val();
            var datatype = $el.data('type') || '';// 数据类型 email , mobile , ID,
            // console.log(name, type, id, val, datatype);
            var required = $el.attr('required') || datatype.indexOf('required') !== -1;

            if (val == '') {
                if (!required) {
                    $el.tipValid();
                    return true;
                }

                var errMsg = type == 'file' ? '照片不能为空！' : '不能为空！'
                $el.tipWarn(errMsg);
                return false;
            }

            if (datatype.indexOf('realname') !== -1 && !isName(val)) {
                $el.tipWarn('姓名不能是数字或特殊字符！');
                return false;
            }
            if (datatype.indexOf('schoolname') !== -1 && !isMathEngCha(val)) {
                $el.tipWarn('允许输入汉字英文数字空格！');
                return false;
            }
            if (datatype.indexOf('agenumber') !== -1 && !isAgemenber(val)) {
                $el.tipWarn('请输入正确的年龄！');
                return false;
            }
            if (datatype.indexOf('height_cm') !== -1 && !isHeightnum(val)) {
                $el.tipWarn('请输入正确的身高！');
                return false;
            }
            if (datatype.indexOf('email') !== -1 && !isEmail(val)) {
                $el.tipWarn('邮件格式不正确！');
                return false;
            }
            if (datatype.indexOf('mobile') !== -1 && !isMobile(val)) {
                $el.tipWarn('手机格式不正确！');
                return false;
            }
            if (datatype.indexOf('ID') !== -1 && ! isID(val)) {
                $el.tipWarn('身份证号格式不正确！');
                return false;
            }

            if (datatype.indexOf('float') !== -1 && ! isFloat(val)) {
                $el.tipWarn('数据格式不正确');
                return;
            }

            // 邀请码
            if (datatype.indexOf('invitecode') !== -1 && ! invitecodeCheck(val)) {
                $el.tipWarn('请您输入有效邀请码！');
                return false;
            }

            // 队名检测 :: BUG: 不知道问么
            if (datatype.indexOf('teamname') !== -1 && ! teamNameCheck(val)) {
                $el.tipWarn('队伍名已被占用！');
                return false;
            }

            if (datatype.indexOf('verificationcode') !== -1 && ! verificationcodeCheck(val)) {
                $el.tipWarn('您输入的手机验证码有误,请核对短信后再次输入！');
                return false;
            }

            $el.tipValid();
            return true;
        }

        //切换页面
        var tabCenter = (function(){
            var tabIndexCenter = 0;
            function displayTab(index) {
                var navTab = $('.tab_menu ul li').get(index);
                $(navTab).addClass('active').siblings().removeClass('active');
                var actTab = $('.all_info .div_tab').get(index);
                $(actTab).addClass('active').siblings().removeClass('active');
            }
            return {
                currentIndex: function(){
                    return tabIndexCenter;
                },
                currentTab: function(){
                    return $('.all_info .div_tab').get(tabIndexCenter);
                },

                go: function(index, preCallback, afterCallback){
                    var maxlen = $('.tab_menu ul li').length;
                    if (index < 0 || maxlen <= index) {
                        console.warn('invalid TabIndex!');
                        return;
                    }

                    var prevent = false;

                    if (preCallback) {
                        prevent = ! preCallback(tabIndexCenter); // 传入变化之前的数值
                    }

                    if (prevent) {
                        return;
                    }

                    displayTab(index);
                    tabIndexCenter = index;

                    if (typeof afterCallback == "function") {
                        afterCallback(index); // 传入变化之后的数值
                    }

                },

                next: function(preCallback, afterCallback)
                {
                    this.go(tabIndexCenter + 1, preCallback, afterCallback);
                },

                previous: function(preCallback, afterCallback)
                {
                   this.go(tabIndexCenter - 1, preCallback, afterCallback);
                }
            }
        }());

        // 添加成员
        var addMemberList = (function() {
            var addIndex = 0;

            // var nations = ['汉族','壮族','回族','满族','维吾尔族','苗族','彝族','土家族','藏族','蒙古族','侗族','布依族','瑶族','白族','朝鲜族','哈尼族','黎族',
            //                 '哈萨克族','傣族','畲族','傈僳族','东乡族','仡佬族','拉祜族','佤族','水族','纳西族','羌族','土族','仫佬族','锡伯族','柯尔克孜族','景颇族',
            //                 '达斡尔族','撒拉族','布朗族','毛南族','塔吉克族','普米族','阿昌族','怒族','鄂温克族','京族','基诺族','德昂族','保安族','俄罗斯族','裕固族',
            //                 '乌孜别克族','门巴族','鄂伦春族','独龙族','赫哲族','高山族','珞巴族','塔塔尔族','未识别民族','入籍外国人'];

            return function(type) {
                type = type || 'member';
                var tmpl = $.templates("#tmpl_memberlist");
                var rawHtml = tmpl.render({
                    'index': addIndex,
                    'type': type,
                    // 'nations': nations
                });

                if (type == 'member') {
                    $('.student_info .students').append(rawHtml);
                } else {
                    $('.leader_info .teachers').append(rawHtml);
                }

                var addHtmlId = '#member_list_' + addIndex + ' ';

                // 表单验证

                $(addHtmlId + " input").blur(function(){
                    validField(this);
                    return false;
                });

                $(addHtmlId + " input").not('.input-field-datetime').focus(function(){
                    $(this).tipClear();
                    var tip_info = $(this).attr('tip-info');
                    var required = $(this).attr('required');
                    var tip_info = tip_info ? tip_info : required ? '不能为空' : '';
                    if (tip_info) {
                        $(this).tipInfo(tip_info);
                    }
                });

                // 上传队员照片
                $(addHtmlId + " input[type=file]").change(function(){
                    validField(this);
                });

                $(addHtmlId + '.uploadBtn').click(function() {
                    $(this).siblings('.uploadField').click();
                });

                // 时间选择插件
                $(addHtmlId + ' input[data-toggle="datepicker"]').datepicker();

                // 删除按钮
                $(addHtmlId + ' .delete').click(function(){
                    $(this).parent().remove();
                    getPersonCount(type);

                });

                // 修改证件类型
                $(addHtmlId + ' .id_type').change(function(){
                    var selectedValue = $(this).find('option:selected').val();
                    if (selectedValue == '身份证') {
                        $(addHtmlId + ' .id_number').attr('data-type', 'ID');
                    } else {
                        $(addHtmlId + ' .id_number').removeAttr('data-type');
                        // **** 直接removeAttr， $.data() 仍然可以取出旧值
                        $(addHtmlId + ' .id_number').removeData('type');

                    }
                });

                // 更新添加按钮状态
                getPersonCount(type);

                addIndex++;
            }
        })();

        // 更新添加状态
        function getPersonCount(type) {
            if (type.indexOf('member') !== -1) {
                var studentCount = $('.students .person_data').length;
                if (studentCount > 0) {
                    $('.students .person_data').eq(0).find('.delete').unbind('click').css('display', 'none');
                }

                if (studentCount >= 8) {
                    $('#add_student').addClass('disabled');
                } else {
                    $('#add_student').removeClass('disabled');
                }

                return studentCount;

            } else {
                var teacherCount = $('.teachers .person_data').length;
                if (teacherCount > 0) {
                    $('.teachers .person_data').eq(0).find('.delete').unbind('click').css('display', 'none');
                }

                if (teacherCount >= 2) {
                    $('#add_teacher').addClass('disabled');
                } else {
                    $('#add_teacher').removeClass('disabled');
                }

                return teacherCount;
            }

            // body...
        }

        // TABINDEX：2 比赛项目
        function buildOptions(data) {
            // console.log('OPTION_DATA', data);
            var arr = [];
            for (key in data){
                arr.push(data[key]);
            }
            var tmpl = $.templates('#tmpl_competiton_options');
            return tmpl.render({'options': arr})
        };

        function getOptions(key) {
            key = key || 0 ;
            var data = {!! $competitonsJson !!};

            if (key == 0) {
                return data;
            }

            var datalist = {
                'children': data,
            }
            return findChildrenItems(datalist, key);
        }

        function findChildrenItems(datalist, parent_id) {
            if (!datalist['children']) {
                return;
            }

            for(k in datalist['children'])
            {
                if (k == parent_id) {
                    return datalist['children'][k]['children'];
                }
                var ret = findChildrenItems(datalist['children'][k], parent_id);
                if (ret) {
                    return ret;
                }
            }
            return;
        }

        function fillOptions(level, key) {
            level = level || 1;
            key = key || 0;
            var options_data = getOptions(key);
            var options_html = buildOptions(options_data);

            // 更新下拉选项
            $('#competition_' + level).html(options_html);
            if (level < 3) {
                $('#competition_' + level).change();
            }
        }


        function buildPreview(type) {
            var container = type == 'member' ? '.students .person_data' : '.teachers .person_data';

            var resultHtml = '';
            var imgPreviewUrl = '';
            var localUrl = '';
            $(container).each(function(index){
                // console.log(this);

                var data = new Array();
                $(this).find('.input-field').each(function(){
                    var name = $(this).find('.input-label').html();
                    var $el_input = $(this).find('input, select').eq(0);
                    var value = '';
                    if ($el_input.is('select')) {
                        console.log('selec');
                        value = $el_input.find('option:selected').val();
                    } else if($el_input.attr('type') == 'radio') {
                        value = $(this).find('input:radio:checked').val();
                    } else if ($el_input.attr('type') == 'file') {
                        value = $el_input.val();


                        if( detectIE() != 'IE8' && detectIE() != 'IE9'){
                            var source_id = $el_input.attr('id');
                            var f = document.getElementById(source_id).files[0];
                            if (f) {
                                console.log(f);
                                imgPreviewUrl = window.URL.createObjectURL(f);
                                console.log(imgPreviewUrl);
                            }

                        }

                        localUrl = $el_input.val();

                    } else {
                        value = $el_input.val();
                    }

                    // 图片项不显示
                    if ($el_input.attr('type') != 'file') {
                        data.push({
                            name: name,
                            value: value
                        })
                    }
                });

                var tmpl = $.templates('#tmpl_preview_memberlist');
                resultHtml += tmpl.render({'type' : type, 'index': index,'datalist' : data, 'imgurl': imgPreviewUrl, 'localUrl': localUrl});
            });

            return resultHtml;
        }


        function previewList() {
            var idNames = new Array(
                // 联系人信息
                'contact_name',
                'contact_mobile',
                'contact_email',
                'contact_remark',
                // 赛项信息
                'team_no',
                'team_name',
                'competition_1',
                'competition_2',
                'competition_3',
                'remarks',
                // 开票信息
                'invoice_type',
                'invoice_title',
                'invoice_code',
                'invoice_money',
                'invoice_mail_address',
                'invoice_mail_recipients',
                'invoice_mail_mobile',
                'invoice_mail_email',
                'invoice_remark'
            )

            for(i in idNames)
            {
                $el = $('#' + idNames[i]);
                var val = $el.val();
                if ($el.is('select')) {
                    val = $el.find('option:selected').text();
                }
                $('#preview_' + idNames[i]).html(val);
            }

            $('#preview_leader').html(buildPreview('leader'));
            $('#preview_member').html(buildPreview('member'));

            if (detectIE() == 'IE8' || detectIE() == 'IE9') {
                $('.preview-pic').each(function(){
                    var source_id = $(this).attr('id');
                    var imgObj = document.getElementById("preview");
                    var dataURL = $(this).attr('local-src');
                    imgObj.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                    imgObj.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = dataURL;
                });
            }

        }

        function copyContactInfo() {

            var value =  $('#add_contact').find('option:selected').val();
            // 如果选的是添加联系人信息，就不修改
            if (value == 'yes') {
                return;
            }

            var $el = $('.teachers .person_data').eq(0);
            if ($el) {
                var name = $el.find('input.name').val();
                var mobile = $el.find('input.tel').val();
                var email = $el.find('input.mail').val();
                $('#contact_name').val(name);
                $('#contact_mobile').val(mobile);
                $('#contact_email').val(email);
            }
        }



        // 提取联系人手机
        function getContactMobile() {
             return $('#contact_mobile').val();
        }

        $(function(){

            // 0. 报名须知
            $('#input-read').click(function (){
                if ($(this).prop("checked") == false) {
                    $('#btn-read').addClass('disabled');
                    $('#btn-read').unbind('click');
                } else {
                    $('#btn-read').removeClass('disabled');
                    $('#btn-read').bind('click', function(event) {
                        $('.instructions').removeClass('active');
                        $('.content').addClass('active');
                    });
                }
            });

            $('#btn-read').click(function (){
                $('.instructions').removeClass('active');
                $('.content').addClass('active');
            });

            // 1. 邀请码，联系人信息
            $('#invitecode').blur(function() {
                validField(this);
            });

            $('#add_contact').change(function() {
                var val = $(this).find('option:selected').val();
                if (val == 'yes') {
                    $('.add_contact').not('#contact_remark').attr('required', true);
                    $('.add_contact').removeClass('disabled');
                    $('.add_contact').removeAttr('readonly');

                } else {
                    $('.add_contact').removeAttr('required');
                    $('.add_contact').addClass('disabled');
                    $('.add_contact').attr('readonly', true);
                    $('.add_contact').val('');
                    copyContactInfo();
                }
            });

            // TODO: 用户可选择是否添加联系人

            // 2. 添加领队

            $('#add_teacher').click(function(event) {
                var count = getPersonCount('leader');
                if (count >= 2) {
                    console.warn('too many');
                    return;
                }

                addMemberList('leader');
            });

            // TODO: 添加按钮 DISABLED
            // TODO: 最大人数限制

            // 3. 赛项信息 加载比赛项目数据， 校验队伍名称
            $('#team_name').blur(function() {
                validField(this);
            });

            fillOptions();
            setTimeout(function(){
                $('#competition_1').change();
            }, 300);
            $('.select-box').change(function() {
                var level = $(this).attr('level');
                var key = $(this).find('option:selected').val();
                var next_level = parseInt(level) + 1;
                fillOptions(next_level, key);
            });



            // 4. 添加队员
            $('#add_student').click(function (){

                var count = getPersonCount('leader');
                if (count >= 8) {
                    console.warn('too many');
                    return;
                }
                addMemberList('member');
            });

            // TODO: 添加按钮 DISABLED
            // TODO: 最大人数限制

            // 5. 开票信息
            // TODO&MAYBE: 根据人数计算金额
            $('#invoice_type').change(function(){
                var selectedValue = $(this).find('option:selected').val();
                if (selectedValue == '发票') {
                    $('.invoice-group').not('#invoice_remark').attr('required', true);
                    $('.invoice-group').removeClass('disabled');
                    $('.invoice-group').removeAttr('readonly');
                } else if (selectedValue == '收据') {
                    $('.invoice-group').not('#invoice_remark').attr('required', true);
                    $('.invoice-group').removeClass('disabled');
                    $('.invoice-group').removeAttr('readonly');

                    $('#invoice_code').removeAttr('required');
                    $('#invoice_code').addClass('disabled');
                    $('#invoice_code').attr('readonly', true);

                } else if (selectedValue == '不开票') {
                    $('.invoice-group').val('');
                    $('.invoice-group').removeAttr('required');
                    $('.invoice-group').addClass('disabled');
                    $('.invoice-group').attr('readonly', true);
                }
            });

            $('.invoice-group').blur(function(){
                validField(this);
            })

            // 6. 信息确认
            // TODO: 信息预览
            // 获取验证码
            // 提交

            // 邀请码校验
            $("#verificationcode").blur(function() {
                validField(this);
            });

            // 6.1 点击「获取手机验证码」按钮，展示窗口
            $('#getverifycode').click(function() {
                var mobile = getContactMobile();
                var partten = /^1\d{10}$/;
                console.log(mobile);
                if(! partten.test(mobile)) {
                    $('#verificationcode').tipWarn('请输入正确的联系人手机号！');
                    return;
                }
                $('.verificationcode_box').show();
                $('#tipes i').html(mobile);
            });

            // 6.2 发送手机验证码
            $('#sendCode').click(function() {
                var captchacode = $('#v_code').val();
                var mobile = getContactMobile();
                var type = 'mobile';

                $.post(
                    "{{url('/verificationcode/send')}}",
                    {
                        type    : type,
                        captcha : captchacode,
                        mobile  : mobile,
                    },
                    function(res){
                        if (res.status == 0) {
                            // 验证码填写成功并确定
                            $('.verificationcode_box').hide();
                            $('#getverifycode').countdown();
                        } else {
                            // 验证码填写错误
                            $('.tipes-false').css('opacity', 1);
                        }
                        // 刷新验证码
                        $('#captcha_img1').refreshCaptcha();
                    }
                );
            });

            // 6.2 点击刷新验证码图片
            $('#captcha_img1').click(function (){
                $(this).refreshCaptcha();
            });

            // 6.3 发送手机验证码
            $("#getQrcode").click(function() {

                var stop = false;
                $('.div_tab').each(function(index){
                    if (stop) {
                        return;
                    }

                    console.log(index, this);
                    $(this).find('input').each(function(){
                        if (stop) {
                            return;
                        }
                        var ret = validField(this);
                        if (!ret) {
                            console.log('start_' +index, this);
                            stop = true;
                            tabCenter.go(index);
                            return;
                        }
                    });
                });
                if (stop) {
                    return false;
                }

                $('#submit').trigger('click');
                $('#submit').trigger('click');
                $('#submit').trigger('click');
                $('#submit').trigger('click');
                $('#submit').trigger('click');
                $('#submit').trigger('click');
                $('#submit').trigger('click');
                return false;
            });

            // 6.4 点击取消输入验证码
            $('.verificationcode_box .no').click(function() {
                $('.verificationcode_box').hide();
            });
            $('#v_code').click(function(event) {
                $('.tipes-false').css('opacity', 0);
            });

            // 验证码错误提示，关闭
            $('.codeError .close').click(function() {
                $('.codeError').removeClass('active');
            });


            // 7. 提交表单
            $("#submit").click(function() {
                // TODO 校验代码，如果出现错误，那么定位到出错的TAB页面
                $("#form").submit();
            });


            // 通用，翻页
            $('.btn_next').click(function(){
                console.log('tttt');
                tabCenter.next(function(index){
                    var curTab = tabCenter.currentTab();
                    var prevent = false;
                    $(curTab).find('input').each(function(){
                        var ret = validField(this);
                        // 表单验证不通过
                        if (!ret) {
                            prevent = true;
                        }
                    })

                    return !prevent;
                }, function(index) {
                    copyContactInfo();
                    if (index == 5) {
                        previewList();
                    }
                });


            });

            $('.btn_pre').click(function(){
                tabCenter.previous();
            });

            tabCenter.go(0);
            addMemberList('leader');
            addMemberList('member');



        });// end of $(function())



       </script>

    <script id="tmpl_memberlist" type="text/x-jsrender">
        <div class="clearfix person_data  @{{:type}}_list" id="member_list_@{{:index}}" data-index="@{{:index}}">
            <div class="delete"><i class="icon kenrobot ken-close"></i></div>
            <div class="input-field">
                <span class="input-label">姓名  :</span>
                <input data-type="realname" required tip-warn="" tip-info="仅支持英文、汉字" class="input-field-text name" id="@{{:type}}_@{{:index}}_name" name="@{{:type}}[@{{:index}}][name]" type="text" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">性别  :</span>
                <input id="@{{:type}}_@{{:index}}_sex_man" class="input-radio man @{{:type}}_sex" type="radio" checked name="@{{:type}}[@{{:index}}][sex]" value="男"><span>男</span>
                <input id="@{{:type}}_@{{:index}}_sex_woman"  class="input-radio woman @{{:type}}_sex" type="radio" name="@{{:type}}[@{{:index}}][sex]" value="女"><span>女</span>
                <p id="@{{:type}}_@{{:index}}_sex"></p>
            </div>

         <!--    <div class="input-field">
                <span class="input-label">出生日期  :</span>
                <input required type="text" id="@{{:type}}_@{{:index}}_birthday" data-toggle="datepicker" class="input-field-text input-field-datetime"  name="@{{:type}}[@{{:index}}][birthday]" />
                <div class="tips"></div>
            </div> -->
            <div class="input-field">
                <span class="input-label">年龄  :</span>
                <input data-type="agenumber" required tip-info="请填写真实的年龄" class="input-field-text"  id="@{{:type}}_@{{:index}}_age" type="text" name="@{{:type}}[@{{:index}}][age]" value="">
                <div class="tips"></div>
            </div>

            <div class="input-field">
                <span class="input-label">身高  :</span>
                <input data-type="height_cm" required tip-info="请填写真实的身高(cm为单位)" class="input-field-text"  id="@{{:type}}_@{{:index}}_height" type="text" name="@{{:type}}[@{{:index}}][height]" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">单位／学校名称 :</span>
                <input data-type="schoolname" required tip-info="请填写工作单位" class="input-field-text"  id="@{{:type}}_@{{:index}}_work_unit" type="text" name="@{{:type}}[@{{:index}}][work_unit]" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">证件类型  :</span>
                <select name="@{{:type}}[@{{:index}}][idcard_type]" class="input-field-text id_type">
                    <option value="身份证">身份证</option>
                    <option value="内地通行证">内地通行证</option>
                    <option value="台胞证">台胞证</option>
                    <option value="护照">护照</option>
                </select>
            </div>
            <div class="input-field">
                <span class="input-label">证件号码  :</span>
                <input tip-info="请填写证件号码" required class="input-field-text id_number" data-type="ID" id="@{{:type}}_@{{:index}}_ID_number" type="text" name="@{{:type}}[@{{:index}}][idcard_no]" value="">
                <div class="tips"></div>
            </div>
    <!--         <div class="input-field">
                <span class="input-label">户籍地址  :</span>
                <input data-type="schoolname" required tip-info="请填写户籍地址" class="input-field-text"  id="@{{:type}}_@{{:index}}_register_address" type="text" name="@{{:type}}[@{{:index}}][register_address]" value="">
                <div class="tips"></div>
            </div> -->
            <div class="input-field">
                <span class="input-label">居住省市  :</span>
                <input data-type="schoolname" required tip-info="请填写居住省市" class="input-field-text"  id="@{{:type}}_@{{:index}}_home_address" type="text" name="@{{:type}}[@{{:index}}][home_address]" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">手机号码  :</span>
                <input required data-type="mobile" tip-info="请填写正确的手机号码" class="input-field-text tel" id="@{{:type}}_@{{:index}}_mobile" name="@{{:type}}[@{{:index}}][mobile]" type="text" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">邮箱  :</span>
                <input required data-type="email" tip-info="请按照正确的邮箱格式填写" class="input-field-text mail" id="@{{:type}}_@{{:index}}_mail" name="@{{:type}}[@{{:index}}][mobile]" type="text" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">备注  :</span>
                <input tip-info="请填写备注信息" class="input-field-text mail" id="@{{:type}}_@{{:index}}_remarks" name="@{{:type}}[@{{:index}}][remark]" type="text" value="">
                <div class="tips"></div>
            </div>
            <div class="input-field">
                <span class="input-label">照片  :</span>
                <div class="uploadBtn">上传照片 </div>
                <input tip-info="格式 PNG/JPG 文件大小 <= 2M" accept="image/jpeg,image/png" required name="@{{:type}}[@{{:index}}][pic]" id="@{{:type}}_@{{:index}}_pic" type="file" class="uploadField @{{:type}}_pic" >
                <div class="tips"></div>
            </div>
        </div>
    </script>
    <script id="tmpl_preview_memberlist" type="text/x-jsrender">
        <div class="leader_info" style="position: relative;">
            <div class="cut"></div>
            @{{for datalist}}
            <div class="input-field">
                <span class="name">@{{: name}}</span>
                <span class="name_input">@{{: value}}</span>
            </div>
            @{{/for}}

            <img id="preview_@{{:type }}_@{{: index}}_pic" class="preview-pic" local-src="@{{: localUrl }}" src="@{{: imgurl}}" >
        </div>
    </script>

    <script id="tmpl_competiton_options" type="text/x-jsrender">
        @{{for options}}
            <option value="@{{: id}}"> @{{: name}}</option>}
        @{{/for}}
    </script>
</body>
</html>
